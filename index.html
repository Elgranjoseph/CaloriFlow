<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>CaloriFlow</title>

<style>
    body {
        background: #0d0d14;
        color: #fff;
        font-family: Arial, sans-serif;
        margin: 0;
        padding: 0;
        text-align: center;
    }

    .container {
        width: 95%;
        max-width: 600px;
        margin: auto;
        padding: 20px;
    }

    h1 {
        font-size: 2.5rem;
        font-weight: bold;
        margin-bottom: 10px;
    }

    select, textarea, input {
        width: 100%;
        padding: 14px;
        margin: 10px 0;
        border-radius: 10px;
        border: none;
        font-size: 1rem;
    }

    button {
        width: 100%;
        padding: 16px;
        margin-top: 12px;
        border-radius: 12px;
        border: none;
        font-size: 1.2rem;
        font-weight: bold;
        cursor: pointer;
    }

    .btn-purple { background: #6a4cff; color: #fff; }
    .btn-green { background: #00c853; color: #fff; }
    .btn-yellow { background: #ffeb3b; color: #000; }
    .btn-blue { background: #29b6f6; color: #000; }

    .item {
        background: #1a1a27;
        padding: 12px;
        border-radius: 10px;
        margin: 8px 0;
    }

</style>
</head>
<body>

<div class="container">

    <h1>CaloriFlow</h1>
    <p>Registro diario con memoria propia.</p>

    <!-- Tipo de comida -->
    <label>Tipo de comida</label>
    <select id="tipoComida">
        <option>Desayuno</option>
        <option>Almuerzo</option>
        <option>Merienda</option>
        <option>Cena</option>
        <option>Snack</option>
    </select>

    <!-- Qu√© comiste -->
    <label>¬øQu√© comiste?</label>
    <textarea id="descripcion" placeholder="Ej: 1 taza de caf√© con leche"></textarea>

    <!-- Campos de cantidad -->
    <div style="display:flex; gap:10px;">
        <div style="flex:1;">
            <label>Cant.</label>
            <input id="cantidad" type="number" value="1">
        </div>

        <div style="flex:1;">
            <label>Porci√≥n</label>
            <select id="porcion">
                <option>unidad</option>
                <option>taza</option>
                <option>vaso</option>
                <option>porcion</option>
                <option>cuchara</option>
            </select>
        </div>

        <div style="flex:2;">
            <label>Alimento</label>
            <input id="alimento" placeholder="caf√©, arroz, manzana...">
        </div>
    </div>

    <!-- Bot√≥n generar prompt -->
    <button class="btn-purple" id="btnPrompt">üß† Generar prompt para ChatGPT</button>

    <!-- Resultados pegados -->
    <label style="margin-top:20px;">Pega aqu√≠ el resultado de ChatGPT (JSON)</label>
    <textarea id="jsonResultado" placeholder='{"calorias":120,"azucares_g":10,"grasas_g":4,"proteinas_g":6}'></textarea>

    <button class="btn-green" id="btnAgregar">‚úîÔ∏è Agregar comida</button>
    <button class="btn-yellow" id="btnResumen">üìä Ver resumen de hoy</button>
    <button class="btn-blue" id="btnBaseAprendida">üìö Ver base aprendida</button>

    <div id="areaResultados"></div>
</div>

<script>
// ------------------------------
//  GUARDA Y CARGA LOCALSTORAGE
// ------------------------------
let comidas = JSON.parse(localStorage.getItem("comidas") || "[]");
let baseAprendida = JSON.parse(localStorage.getItem("baseAprendida") || "{}");

function guardarTodo() {
    localStorage.setItem("comidas", JSON.stringify(comidas));
    localStorage.setItem("baseAprendida", JSON.stringify(baseAprendida));
}

// ------------------------------
//  GENERAR PROMPT (SIN ABRIR CHATGPT)
// ------------------------------
document.getElementById("btnPrompt").addEventListener("click", async () => {
    const desc = document.getElementById("descripcion").value.trim();
    const cant = document.getElementById("cantidad").value.trim();
    const porc = document.getElementById("porcion").value.trim();
    const ali  = document.getElementById("alimento").value.trim();

    if (!desc && !ali) {
        alert("Escrib√≠ qu√© comiste o us√° los campos r√°pidos.");
        return;
    }

    const descripcionFinal = desc || `${cant} ${porc} de ${ali}`;

    const prompt = `
Quiero que me estimes los valores nutricionales aproximados.

Comida: "${descripcionFinal}"

Devu√©lveme SOLO un JSON v√°lido y en UNA sola l√≠nea, sin explicaci√≥n extra:

{
  "calorias": 0,
  "azucares_g": 0,
  "grasas_g": 0,
  "proteinas_g": 0
}

No agregues m√°s campos.
    `.trim();

    try {
        await navigator.clipboard.writeText(prompt);
        alert("Prompt copiado. Abr√≠ tu ChatGPT (el que ya ten√©s abierto) y pegalo ah√≠.");
    } catch (e) {
        alert("No pude copiar autom√°ticamente. Copialo manualmente.");
    }
});

// ------------------------------
//  AGREGAR COMIDA
// ------------------------------
document.getElementById("btnAgregar").addEventListener("click", () => {
    const tipo = document.getElementById("tipoComida").value;
    const desc = document.getElementById("descripcion").value.trim();
    const cant = document.getElementById("cantidad").value;
    const porc = document.getElementById("porcion").value;
    const ali  = document.getElementById("alimento").value.trim();
    const json = document.getElementById("jsonResultado").value.trim();

    if (!json) {
        alert("Peg√° el JSON generado por ChatGPT.");
        return;
    }

    let datos;
    try {
        datos = JSON.parse(json);
    } catch (e) {
        alert("El JSON no es v√°lido.");
        return;
    }

    const descripcionFinal = desc || `${cant} ${porc} de ${ali}`;

    comidas.push({
        tipo,
        descripcion: descripcionFinal,
        ...datos,
        fecha: new Date().toLocaleString()
    });

    // GUARDAR EN MEMORIA APRENDIDA
    baseAprendida[descripcionFinal.toLowerCase()] = datos;

    guardarTodo();

    alert("Comida agregada correctamente.");

    document.getElementById("jsonResultado").value = "";
});

// ------------------------------
//  RESUMEN DE HOY
// ------------------------------
document.getElementById("btnResumen").addEventListener("click", () => {
    const area = document.getElementById("areaResultados");
    area.innerHTML = "";

    if (comidas.length === 0) {
        area.innerHTML = "<p>No registraste comidas hoy.</p>";
        return;
    }

    comidas.forEach(c => {
        const div = document.createElement("div");
        div.className = "item";
        div.innerHTML = `
            <b>${c.tipo}</b> ¬∑ ${c.fecha}<br>
            - ${c.descripcion}<br>
            ${c.calorias} kcal ¬∑ ${c.azucares_g} g az√∫car ¬∑ ${c.grasas_g} g grasa ¬∑ ${c.proteinas_g} g prote√≠na
        `;
        area.appendChild(div);
    });
});

// ------------------------------
//  BASE APRENDIDA
// ------------------------------
document.getElementById("btnBaseAprendida").addEventListener("click", () => {
    const area = document.getElementById("areaResultados");
    area.innerHTML = "<h3>Base aprendida</h3>";

    const claves = Object.keys(baseAprendida);

    if (claves.length === 0) {
        area.innerHTML += "<p>No hay datos aprendidos a√∫n.</p>";
        return;
    }

    claves.forEach(k => {
        const d = baseAprendida[k];
        const div = document.createElement("div");
        div.className = "item";
        div.innerHTML = `
            <b>${k}</b><br>
            ${d.calorias} kcal ¬∑ ${d.azucares_g} g az√∫car ¬∑ ${d.grasas_g} g grasa ¬∑ ${d.proteinas_g} g prote√≠na
        `;
        area.appendChild(div);
    });
});
</script>

</body>
</html>