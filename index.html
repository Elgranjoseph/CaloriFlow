<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>CaloriFlow</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root {
      --bg-main: #050816;
      --card-bg: #101525;
      --accent: #ff4fd8;
      --accent-soft: #2b2f43;
      --text-main: #f7f7ff;
      --text-muted: #a7b0d0;
      --danger: #ff4f6a;
      --success: #3ddc84;
      --warning: #ffc857;
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI",
        sans-serif;
    }

    body {
      min-height: 100vh;
      background: radial-gradient(circle at top, #1e2240 0, #050816 45%, #02010a 100%);
      color: var(--text-main);
      display: flex;
      align-items: flex-start;
      justify-content: center;
      padding: 16px 8px 32px;
    }

    .app-container {
      width: 100%;
      max-width: 480px;
    }

    .card {
      background: linear-gradient(145deg, #101525 0%, #050816 100%);
      border-radius: 24px;
      padding: 20px 18px 22px;
      box-shadow: 0 18px 40px rgba(0, 0, 0, 0.8);
      border: 1px solid rgba(255, 255, 255, 0.04);
    }

    .title {
      text-align: center;
      font-size: 28px;
      font-weight: 800;
      letter-spacing: 0.04em;
      margin-bottom: 6px;
    }

    .subtitle {
      text-align: center;
      font-size: 13px;
      color: var(--text-muted);
      margin-bottom: 18px;
    }

    label {
      display: block;
      font-size: 14px;
      margin-bottom: 6px;
      color: var(--text-muted);
    }

    select,
    textarea,
    input[type="text"],
    input[type="number"] {
      width: 100%;
      border-radius: 14px;
      border: 1px solid rgba(255, 255, 255, 0.08);
      padding: 10px 12px;
      font-size: 15px;
      background: rgba(5, 8, 22, 0.9);
      color: var(--text-main);
      outline: none;
    }

    select:focus,
    textarea:focus,
    input:focus {
      border-color: var(--accent);
      box-shadow: 0 0 0 1px rgba(255, 79, 216, 0.4);
    }

    textarea {
      min-height: 64px;
      resize: vertical;
    }

    .field-group {
      margin-bottom: 12px;
    }

    .btn {
      width: 100%;
      border: none;
      border-radius: 18px;
      padding: 12px 14px;
      font-size: 16px;
      font-weight: 600;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      margin-top: 8px;
      cursor: pointer;
      transition: transform 0.08s ease, box-shadow 0.08s ease, opacity 0.1s;
    }

    .btn span.emoji {
      font-size: 18px;
    }

    .btn-primary {
      background: #4f46e5;
      color: #ffffff;
      box-shadow: 0 10px 25px rgba(79, 70, 229, 0.5);
    }

    .btn-success {
      background: var(--success);
      color: #041013;
      box-shadow: 0 10px 25px rgba(61, 220, 132, 0.5);
    }

    .btn-warning {
      background: var(--warning);
      color: #231b06;
      box-shadow: 0 10px 25px rgba(255, 200, 87, 0.5);
    }

    .btn-secondary {
      background: rgba(255, 255, 255, 0.06);
      color: var(--text-main);
      box-shadow: 0 6px 16px rgba(0, 0, 0, 0.5);
      font-size: 14px;
    }

    .btn-danger {
      background: rgba(255, 79, 106, 0.1);
      color: var(--danger);
      border-radius: 999px;
      padding: 8px 14px;
      font-size: 13px;
      box-shadow: none;
      width: auto;
    }

    .btn:active {
      transform: translateY(1px) scale(0.99);
      box-shadow: none;
      opacity: 0.9;
    }

    .helper-text {
      font-size: 11px;
      color: var(--text-muted);
      margin-top: 4px;
      line-height: 1.4;
    }

    .status-text {
      font-size: 13px;
      margin-top: 10px;
      min-height: 18px;
    }

    .status-ok {
      color: var(--success);
    }

    .status-error {
      color: var(--danger);
    }

    .tiny-link {
      font-size: 11px;
      color: var(--text-muted);
      margin-top: 8px;
    }

    .tiny-link button {
      background: none;
      border: none;
      color: var(--accent);
      font-size: 11px;
      padding: 0;
      text-decoration: underline;
      cursor: pointer;
    }

    .hidden {
      display: none;
    }

    /* Resumen & DB */

    .header-row {
      display: flex;
      align-items: center;
      margin-bottom: 12px;
    }

    .back-btn {
      border: none;
      background: var(--accent);
      color: #ffffff;
      border-radius: 999px;
      padding: 6px 12px;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      font-size: 13px;
      cursor: pointer;
      box-shadow: 0 8px 18px rgba(255, 79, 216, 0.5);
    }

    .header-row h2 {
      flex: 1;
      text-align: center;
      font-size: 22px;
      font-weight: 800;
      margin-right: 36px;
    }

    .summary-section-title {
      font-size: 15px;
      font-weight: 600;
      margin-top: 10px;
      margin-bottom: 6px;
    }

    .summary-row {
      display: flex;
      justify-content: space-between;
      font-size: 14px;
      margin-bottom: 4px;
    }

    .summary-label {
      color: var(--text-muted);
    }

    .summary-value {
      font-weight: 600;
    }

    .progress-group {
      margin-top: 10px;
    }

    .progress-label-row {
      display: flex;
      justify-content: space-between;
      font-size: 13px;
      margin-bottom: 3px;
      color: var(--text-muted);
    }

    .progress-bar {
      width: 100%;
      height: 8px;
      border-radius: 999px;
      background: rgba(255, 255, 255, 0.06);
      overflow: hidden;
    }

    .progress-inner {
      height: 100%;
      width: 0%;
      border-radius: 999px;
      background: linear-gradient(90deg, #3ddc84, #86efac);
      transition: width 0.2s ease-out;
    }

    .registered-list-title {
      font-size: 15px;
      font-weight: 600;
      margin-top: 14px;
      margin-bottom: 6px;
    }

    .meal-item {
      border-top: 1px solid rgba(255, 255, 255, 0.06);
      padding-top: 8px;
      margin-top: 8px;
      font-size: 13px;
    }

    .meal-header-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 3px;
    }

    .meal-type-time {
      font-weight: 600;
      font-size: 13px;
    }

    .meal-desc {
      color: var(--text-main);
      margin-bottom: 3px;
    }

    .meal-macros {
      color: var(--text-muted);
      font-size: 12px;
    }

    .goals-row {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      font-size: 11px;
      color: var(--text-muted);
      margin-top: 6px;
    }

    .goal-chip {
      background: rgba(255, 255, 255, 0.04);
      border-radius: 999px;
      padding: 4px 8px;
    }

    .db-item {
      border-top: 1px solid rgba(255, 255, 255, 0.06);
      padding-top: 8px;
      margin-top: 8px;
      font-size: 13px;
    }

    .db-desc {
      font-weight: 600;
      margin-bottom: 4px;
    }

    .db-macros {
      font-size: 12px;
      color: var(--text-muted);
    }

    /* fila cantidad + unidad + alimento */

    .unit-row {
      display: flex;
      gap: 6px;
      margin-top: 4px;
    }

    .unit-row input[type="number"] {
      max-width: 70px;
    }

    .unit-row select {
      max-width: 110px;
    }

    .unit-row input[type="text"] {
      flex: 1;
    }

    @media (min-width: 480px) {
      .card {
        padding: 22px 22px 24px;
      }
    }
  </style>
</head>
<body>
  <div class="app-container">
    <!-- VISTA REGISTRO -->
    <div id="registro-view" class="card">
      <h1 class="title">CaloriFlow</h1>
      <p class="subtitle">Registro diario con memoria propia.</p>

      <div class="field-group">
        <label for="tipo-comida">Tipo de comida</label>
        <select id="tipo-comida">
          <option value="Desayuno">Desayuno</option>
          <option value="Almuerzo">Almuerzo</option>
          <option value="Merienda">Merienda</option>
          <option value="Cena">Cena</option>
          <option value="Snack">Snack</option>
        </select>
      </div>

      <div class="field-group">
        <label for="descripcion-comida">¬øQu√© comiste?</label>
        <textarea
          id="descripcion-comida"
          placeholder="Ej: 1 taza de caf√© con leche"
        ></textarea>
        <div class="unit-row">
          <input id="cantidad-input" type="number" min="0.1" step="0.1" placeholder="Cant." />
          <select id="unidad-select">
            <option value="taza">taza</option>
            <option value="vaso">vaso</option>
            <option value="plato">plato</option>
            <option value="porci√≥n">porci√≥n</option>
            <option value="unidad">unidad</option>
          </select>
          <input id="alimento-input" type="text" placeholder="Alimento" />
        </div>
      </div>

      <button id="btn-generar-prompt" class="btn btn-primary">
        <span class="emoji">üß†</span>
        <span>Generar prompt para ChatGPT</span>
      </button>
      <p class="helper-text">
        Se copiar√° el prompt al portapapeles y se abrir√° ChatGPT. Solo peg√°s el
        prompt, copi√°s el JSON de respuesta y lo tra√©s ac√°.
      </p>

      <div class="field-group" style="margin-top: 12px;">
        <label for="json-chatgpt">Pega aqu√≠ el resultado de ChatGPT (JSON)</label>
        <textarea
          id="json-chatgpt"
          placeholder='{"calorias":120,"azucares_g":10,"grasas_g":4,"proteinas_g":6}'
        ></textarea>
      </div>

      <button id="btn-agregar" class="btn btn-success">
        <span class="emoji">‚úÖ</span>
        <span>Agregar comida</span>
      </button>

      <button id="btn-ver-resumen" class="btn btn-warning">
        <span class="emoji">üìä</span>
        <span>Ver resumen de hoy</span>
      </button>

      <button id="btn-ver-db" class="btn btn-secondary">
        <span class="emoji">üìö</span>
        <span>Ver base aprendida</span>
      </button>

      <p id="status-text" class="status-text"></p>

      <div class="tiny-link">
        Todo se guarda solo en este dispositivo.
        <button id="btn-reset">Resetear base aprendida y comidas de hoy</button>
      </div>
    </div>

    <!-- VISTA RESUMEN -->
    <div id="resumen-view" class="card hidden">
      <div class="header-row">
        <button id="btn-volver-registro" class="back-btn">
          ‚Üê Volver al registro
        </button>
        <h2>Resumen de hoy</h2>
      </div>

      <div id="summary-content"></div>
    </div>

    <!-- VISTA BASE APRENDIDA -->
    <div id="db-view" class="card hidden">
      <div class="header-row">
        <button id="btn-volver-registro-db" class="back-btn">
          ‚Üê Volver al registro
        </button>
        <h2>Base aprendida</h2>
      </div>
      <div id="db-content"></div>
    </div>
  </div>

  <script>
    const DB_KEY = "caloriflow_food_db_v1";
    const LOG_KEY = "caloriflow_daily_logs_v1";

    const DAILY_GOALS = {
      calorias: 2000,
      azucares_g: 50,
      grasas_g: 60,
      proteinas_g: 70,
    };

    function todayKey() {
      const d = new Date();
      return d.toISOString().slice(0, 10);
    }

    function loadJSON(key, fallback) {
      try {
        const t = localStorage.getItem(key);
        if (!t) return fallback;
        return JSON.parse(t);
      } catch {
        return fallback;
      }
    }

    function saveJSON(key, value) {
      localStorage.setItem(key, JSON.stringify(value));
    }

    function normalizeDescription(text) {
      return text
        .toLowerCase()
        .normalize("NFD")
        .replace(/[\u0300-\u036f]/g, "")
        .replace(/\s+/g, " ")
        .trim();
    }

    function getFoodDB() {
      return loadJSON(DB_KEY, {});
    }

    function setFoodDB(db) {
      saveJSON(DB_KEY, db);
    }

    function getLogs() {
      return loadJSON(LOG_KEY, {});
    }

    function setLogs(logs) {
      saveJSON(LOG_KEY, logs);
    }

    // ELEMENTOS
    const registroView = document.getElementById("registro-view");
    const resumenView = document.getElementById("resumen-view");
    const dbView = document.getElementById("db-view");

    const tipoComidaEl = document.getElementById("tipo-comida");
    const descEl = document.getElementById("descripcion-comida");
    const jsonEl = document.getElementById("json-chatgpt");
    const statusEl = document.getElementById("status-text");

    const cantidadInput = document.getElementById("cantidad-input");
    const unidadSelect = document.getElementById("unidad-select");
    const alimentoInput = document.getElementById("alimento-input");

    const btnPrompt = document.getElementById("btn-generar-prompt");
    const btnAgregar = document.getElementById("btn-agregar");
    const btnVerResumen = document.getElementById("btn-ver-resumen");
    const btnVerDB = document.getElementById("btn-ver-db");
    const btnReset = document.getElementById("btn-reset");
    const btnVolverRegistro = document.getElementById("btn-volver-registro");
    const btnVolverRegistroDB = document.getElementById("btn-volver-registro-db");

    const summaryContent = document.getElementById("summary-content");
    const dbContent = document.getElementById("db-content");

    function setStatus(message, isError = false) {
      statusEl.textContent = message || "";
      statusEl.className = "status-text " + (isError ? "status-error" : "status-ok");
    }

    // Atajo cantidad + unidad + alimento
    function updateDescFromParts() {
      const cantidad = (cantidadInput.value || "").trim();
      const unidad = unidadSelect.value;
      const alimento = (alimentoInput.value || "").trim();

      if (!cantidad || !alimento) return;

      const texto = `${cantidad} ${unidad} de ${alimento}`;
      descEl.value = texto;
    }

    cantidadInput.addEventListener("input", updateDescFromParts);
    unidadSelect.addEventListener("change", updateDescFromParts);
    alimentoInput.addEventListener("input", updateDescFromParts);

    // Prompt para ChatGPT
    btnPrompt.addEventListener("click", () => {
      const desc = descEl.value.trim();
      if (!desc) {
        setStatus("Escrib√≠ primero qu√© comiste.", true);
        return;
      }

      const prompt = `
Eres un nutricionista.

Analiza la siguiente comida COMPLETA y devuelve los valores totales:

Tipo de comida: ${tipoComidaEl.value}

√çtems de la comida:
1. ${desc}

Quiero que estimes para toda la comida en conjunto:
- calor√≠as totales (kcal)
- gramos de az√∫cares
- gramos de grasas
- gramos de prote√≠nas

MUY IMPORTANTE:
- Responde SOLO un JSON v√°lido.
- SIN explicaciones, SIN comentarios, SIN texto antes o despu√©s.
- NO uses bloques de c√≥digo ni \`\`\`.
- Escribe el JSON en UNA SOLA L√çNEA.

Formato exacto:
{"calorias": 0, "azucares_g": 0, "grasas_g": 0, "proteinas_g": 0}

Rellena los valores con n√∫meros (pueden ser decimales).
`.trim();

      if (navigator.clipboard && navigator.clipboard.writeText) {
        navigator.clipboard.writeText(prompt).catch(() => {});
      }

      const url = "https://chat.openai.com/?q=" + encodeURIComponent(prompt);
      window.open(url, "_blank");

      setStatus("Prompt copiado. Pegalo en ChatGPT, copi√° el JSON y traelo ac√°.");
    });

    function parseNutritionJSON(raw) {
      if (!raw || !raw.trim()) return null;
      const text = raw.trim();
      const start = text.indexOf("{");
      const end = text.lastIndexOf("}");
      if (start === -1 || end === -1 || end <= start) {
        throw new Error("No encontr√© un JSON v√°lido entre llaves.");
      }
      const jsonPart = text.slice(start, end + 1);
      let data;
      try {
        data = JSON.parse(jsonPart);
      } catch (e) {
        throw new Error("JSON inv√°lido. Revis√° que la sintaxis est√© bien.");
      }

      const required = ["calorias", "azucares_g", "grasas_g", "proteinas_g"];
      for (const key of required) {
        if (!(key in data)) {
          throw new Error(`Falta la clave "${key}" en el JSON.`);
        }
        const num = Number(data[key]);
        if (!isFinite(num)) {
          throw new Error(`El valor de "${key}" no es un n√∫mero v√°lido.`);
        }
        data[key] = num;
      }
      return data;
    }

    // Agregar comida
    btnAgregar.addEventListener("click", () => {
      const tipo = tipoComidaEl.value;
      const desc = descEl.value.trim();
      if (!desc) {
        setStatus("Escrib√≠ qu√© comiste.", true);
        return;
      }

      const normalized = normalizeDescription(desc);
      let db = getFoodDB();
      let logs = getLogs();
      const hoy = todayKey();
      if (!logs[hoy]) logs[hoy] = [];

      const rawJSON = jsonEl.value.trim();
      let valores;

      if (rawJSON) {
        try {
          valores = parseNutritionJSON(rawJSON);
        } catch (e) {
          setStatus(e.message, true);
          return;
        }
        db[normalized] = valores;
        setFoodDB(db);
      } else {
        if (!db[normalized]) {
          setStatus(
            "Comida nueva para la app. Primero us√° ChatGPT una vez para que pueda aprenderla.",
            true
          );
          return;
        }
        valores = db[normalized];
      }

      const now = new Date();
      const timeStr = now.toLocaleTimeString([], {
        hour: "2-digit",
        minute: "2-digit",
        second: "2-digit",
      });

      logs[hoy].push({
        tipo,
        descripcion: desc,
        tiempo: timeStr,
        calorias: valores.calorias,
        azucares_g: valores.azucares_g,
        grasas_g: valores.grasas_g,
        proteinas_g: valores.proteinas_g,
      });

      setLogs(logs);

      jsonEl.value = "";
      descEl.value = "";
      cantidadInput.value = "";
      alimentoInput.value = "";

      setStatus("Comida guardada en el registro de hoy.");
    });

    // Reset
    btnReset.addEventListener("click", () => {
      if (!confirm("¬øSeguro que quer√©s borrar la base aprendida y las comidas de hoy?")) {
        return;
      }
      const hoy = todayKey();
      const logs = getLogs();
      logs[hoy] = [];
      setLogs(logs);
      setFoodDB({});
      setStatus("Base aprendida y comidas de hoy reseteadas.");
    });

    // NAV: resumen
    btnVerResumen.addEventListener("click", () => {
      renderSummary();
      registroView.classList.add("hidden");
      resumenView.classList.remove("hidden");
      dbView.classList.add("hidden");
      setStatus("");
    });

    btnVolverRegistro.addEventListener("click", () => {
      resumenView.classList.add("hidden");
      registroView.classList.remove("hidden");
    });

    // NAV: base aprendida
    btnVerDB.addEventListener("click", () => {
      renderDB();
      registroView.classList.add("hidden");
      resumenView.classList.add("hidden");
      dbView.classList.remove("hidden");
      setStatus("");
    });

    btnVolverRegistroDB.addEventListener("click", () => {
      dbView.classList.add("hidden");
      registroView.classList.remove("hidden");
    });

    // Resumen
    function renderSummary() {
      const logs = getLogs();
      const hoy = todayKey();
      const comidas = logs[hoy] || [];

      if (!comidas.length) {
        summaryContent.innerHTML = `
          <p class="helper-text" style="margin-bottom:8px;">
            Hoy todav√≠a no registraste comidas.
          </p>
          <p class="helper-text">
            Volv√© al registro, agreg√° alguna comida y despu√©s revis√° el resumen.
          </p>
        `;
        return;
      }

      let total = {
        calorias: 0,
        azucares_g: 0,
        grasas_g: 0,
        proteinas_g: 0,
      };

      comidas.forEach((c) => {
        total.calorias += c.calorias;
        total.azucares_g += c.azucares_g;
        total.grasas_g += c.grasas_g;
        total.proteinas_g += c.proteinas_g;
      });

      function pct(value, goal) {
        if (!goal || goal <= 0) return 0;
        return Math.min(100, (value / goal) * 100);
      }

      const pctCal = pct(total.calorias, DAILY_GOALS.calorias);
      const pctAz = pct(total.azucares_g, DAILY_GOALS.azucares_g);
      const pctGr = pct(total.grasas_g, DAILY_GOALS.grasas_g);
      const pctPr = pct(total.proteinas_g, DAILY_GOALS.proteinas_g);

      let consejo = "";
      if (pctCal < 40) {
        consejo =
          "Vas por debajo de la mitad de tu meta de calor√≠as. Asegurate de no saltearte comidas importantes.";
      } else if (pctCal > 110) {
        consejo =
          "Superaste tu meta cal√≥rica orientativa. Consider√° equilibrar el resto del d√≠a.";
      } else {
        consejo =
          "Est√°s dentro de un rango razonable de tu meta orientativa de calor√≠as.";
      }

      let html = `
        <div class="summary-section-title">Totales de hoy</div>
        <div class="summary-row">
          <span class="summary-label">Calor√≠as totales:</span>
          <span class="summary-value">${total.calorias.toFixed(1)}</span>
        </div>
        <div class="summary-row">
          <span class="summary-label">Az√∫cares totales (g):</span>
          <span class="summary-value">${total.azucares_g.toFixed(1)}</span>
        </div>
        <div class="summary-row">
          <span class="summary-label">Grasas totales (g):</span>
          <span class="summary-value">${total.grasas_g.toFixed(1)}</span>
        </div>
        <div class="summary-row">
          <span class="summary-label">Prote√≠nas totales (g):</span>
          <span class="summary-value">${total.proteinas_g.toFixed(1)}</span>
        </div>

        <div class="summary-section-title" style="margin-top:12px;">Progreso vs metas</div>
        <div class="progress-group">
          <div class="progress-label-row">
            <span>Calor√≠as</span>
            <span>${total.calorias.toFixed(1)} / ${DAILY_GOALS.calorias}</span>
          </div>
          <div class="progress-bar"><div class="progress-inner" style="width:${pctCal}%;"></div></div>
        </div>

        <div class="progress-group">
          <div class="progress-label-row">
            <span>Az√∫cares (g)</span>
            <span>${total.azucares_g.toFixed(1)} / ${DAILY_GOALS.azucares_g}</span>
          </div>
          <div class="progress-bar"><div class="progress-inner" style="width:${pctAz}%;"></div></div>
        </div>

        <div class="progress-group">
          <div class="progress-label-row">
            <span>Grasas (g)</span>
            <span>${total.grasas_g.toFixed(1)} / ${DAILY_GOALS.grasas_g}</span>
          </div>
          <div class="progress-bar"><div class="progress-inner" style="width:${pctGr}%;"></div></div>
        </div>

        <div class="progress-group">
          <div class="progress-label-row">
            <span>Prote√≠nas (g)</span>
            <span>${total.proteinas_g.toFixed(1)} / ${DAILY_GOALS.proteinas_g}</span>
          </div>
          <div class="progress-bar"><div class="progress-inner" style="width:${pctPr}%;"></div></div>
        </div>

        <p class="helper-text" style="margin-top:10px;">${consejo}</p>

        <div class="goals-row">
          <span class="goal-chip">Meta sugerida: ${DAILY_GOALS.calorias} kcal</span>
          <span class="goal-chip">${DAILY_GOALS.azucares_g} g az√∫car</span>
          <span class="goal-chip">${DAILY_GOALS.grasas_g} g grasa</span>
          <span class="goal-chip">${DAILY_GOALS.proteinas_g} g prote√≠na</span>
        </div>

        <div class="registered-list-title">Comidas registradas</div>
      `;

      comidas.forEach((c, idx) => {
        html += `
          <div class="meal-item">
            <div class="meal-header-row">
              <div class="meal-type-time">
                ${c.tipo} ¬∑ ${c.tiempo}
              </div>
              <button class="btn btn-danger" data-idx="${idx}">
                üóë Eliminar
              </button>
            </div>
            <div class="meal-desc">- ${c.descripcion}</div>
            <div class="meal-macros">
              ${c.calorias.toFixed(1)} kcal ¬∑
              ${c.proteinas_g.toFixed(1)} g prot ¬∑
              ${c.grasas_g.toFixed(1)} g grasa ¬∑
              ${c.azucares_g.toFixed(1)} g az√∫car
            </div>
          </div>
        `;
      });

      summaryContent.innerHTML = html;

      summaryContent
        .querySelectorAll("button.btn-danger")
        .forEach((btn) => {
          const index = Number(btn.getAttribute("data-idx"));
          const logs2 = getLogs();
          const arr = logs2[hoy] || [];
          if (index >= 0 && index < arr.length) {
            arr.splice(index, 1);
            logs2[hoy] = arr;
            setLogs(logs2);
            renderSummary();
          }
        });
    }

    // Vista base aprendida
    function renderDB() {
      const db = getFoodDB();
      const entries = Object.entries(db);

      if (!entries.length) {
        dbContent.innerHTML = `
          <p class="helper-text">
            A√∫n no hay comidas aprendidas. Cada vez que pegues un JSON nuevo,
            se ir√° guardando ac√°.
          </p>
        `;
        return;
      }

      let html = `
        <p class="helper-text" style="margin-bottom:8px;">
          Esta es la base interna que la app usa cuando repet√≠s una comida
          sin pasar por ChatGPT.
        </p>
      `;

      entries.forEach(([descNorm, v], idx) => {
        html += `
          <div class="db-item">
            <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:2px;">
              <div class="db-desc">${descNorm}</div>
              <button class="btn btn-danger db-del" data-idx="${idx}">üóë Eliminar</button>
            </div>
            <div class="db-macros">
              ${v.calorias.toFixed(1)} kcal ¬∑
              ${v.proteinas_g.toFixed(1)} g prot ¬∑
              ${v.grasas_g.toFixed(1)} g grasa ¬∑
              ${v.azucares_g.toFixed(1)} g az√∫car
            </div>
          </div>
        `;
      });

      dbContent.innerHTML = html;

      dbContent.querySelectorAll("button.db-del").forEach((btn) => {
        const idx = Number(btn.getAttribute("data-idx"));
        const [key] = entries[idx];
        const dbNow = getFoodDB();
        delete dbNow[key];
        btn.addEventListener("click", () => {
          delete dbNow[key];
          setFoodDB(dbNow);
          renderDB();
        });
      });
    }

    setStatus("");
  </script>
</body>
</html>
