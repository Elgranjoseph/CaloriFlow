<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>CaloriFlow</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root {
      --bg: #050816;
      --card: #101827;
      --card-soft: #131b2b;
      --accent: #7c3aed;
      --accent-soft: #a855f7;
      --accent-strong: #4f46e5;
      --good: #22c55e;
      --good-soft: #16a34a;
      --warn: #facc15;
      --danger: #ef4444;
      --text: #e5e7eb;
      --muted: #9ca3af;
      --border: #1f2933;
      --shadow: 0 18px 45px rgba(0,0,0,0.6);
      --radius-lg: 24px;
      --radius-sm: 12px;
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "SF Pro Text",
        "Segoe UI", sans-serif;
    }

    body {
      min-height: 100vh;
      background: radial-gradient(circle at top, #1f2937 0, #020617 45%, #000 100%);
      color: var(--text);
      display: flex;
      justify-content: center;
      align-items: flex-start;
      padding: 16px;
    }

    .app-shell {
      width: 100%;
      max-width: 460px;
      margin: 0 auto;
    }

    .card {
      background: radial-gradient(circle at top left, #1f2937 0, #020617 55%);
      border-radius: var(--radius-lg);
      padding: 20px 18px 22px;
      box-shadow: var(--shadow);
      border: 1px solid rgba(148,163,184,0.18);
    }

    h1 {
      text-align: center;
      font-size: 1.9rem;
      letter-spacing: 0.06em;
      margin-bottom: 2px;
    }

    .subtitle {
      text-align: center;
      font-size: 0.86rem;
      color: var(--muted);
      margin-bottom: 18px;
    }

    label {
      display: block;
      font-size: 0.86rem;
      margin-bottom: 4px;
      color: #cbd5f5;
    }

    select, textarea, input {
      width: 100%;
      border-radius: 999px;
      border: 1px solid var(--border);
      background: linear-gradient(135deg,#020617,#020617,#020617);
      color: var(--text);
      padding: 10px 12px;
      font-size: 0.95rem;
      outline: none;
      transition: border-color 0.15s, box-shadow 0.15s, background 0.15s;
    }

    textarea {
      border-radius: 16px;
      min-height: 74px;
      resize: vertical;
      line-height: 1.35;
      font-family: "JetBrains Mono", ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      font-size: 0.86rem;
      background: radial-gradient(circle at top left,#020617,#020617,#020617);
    }

    select:focus, textarea:focus, input:focus {
      border-color: var(--accent-soft);
      box-shadow: 0 0 0 1px rgba(168,85,247,0.35);
      background: radial-gradient(circle at top left,#020617,#020617,#020617);
    }

    .field-group {
      margin-bottom: 14px;
    }

    .row {
      display: flex;
      gap: 8px;
    }

    .row > * {
      flex: 1;
    }

    .pill-label {
      font-size: 0.75rem;
      text-transform: uppercase;
      letter-spacing: 0.12em;
      color: var(--muted);
      margin-bottom: 6px;
    }

    .hint {
      font-size: 0.76rem;
      color: var(--muted);
      margin-top: 4px;
    }

    .hint-strong {
      font-size: 0.8rem;
      color: #e5e7eb;
      margin-top: 2px;
    }

    .btn {
      width: 100%;
      border: none;
      border-radius: 999px;
      padding: 11px 16px;
      font-size: 1rem;
      font-weight: 600;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      margin-top: 10px;
      transition: transform 0.08s ease, box-shadow 0.08s ease, filter 0.08s ease;
      box-shadow: 0 12px 30px rgba(0,0,0,0.35);
    }

    .btn span.icon {
      font-size: 1.1rem;
    }

    .btn-primary {
      background: radial-gradient(circle at top left,var(--accent-soft),var(--accent-strong));
      color: #f9fafb;
    }

    .btn-primary:active {
      transform: translateY(1px) scale(0.98);
      box-shadow: 0 6px 18px rgba(0,0,0,0.45);
      filter: brightness(0.95);
    }

    .btn-good {
      background: linear-gradient(135deg,var(--good-soft),#22c55e);
      color: #ecfdf5;
    }

    .btn-good:active {
      transform: translateY(1px) scale(0.98);
      box-shadow: 0 6px 18px rgba(0,0,0,0.45);
      filter: brightness(0.96);
    }

    .btn-warn {
      background: linear-gradient(135deg,#fbbf24,#facc15);
      color: #111827;
    }

    .btn-warn:active {
      transform: translateY(1px) scale(0.98);
      box-shadow: 0 6px 18px rgba(0,0,0,0.45);
      filter: brightness(0.97);
    }

    .btn-secondary {
      background: linear-gradient(135deg,#111827,#020617);
      border: 1px solid rgba(148,163,184,0.4);
      color: #e5e7eb;
    }

    .btn-secondary:active {
      transform: translateY(1px) scale(0.98);
      box-shadow: 0 6px 18px rgba(0,0,0,0.45);
      filter: brightness(0.97);
    }

    .status-msg {
      margin-top: 6px;
      font-size: 0.8rem;
      color: var(--good);
      min-height: 1em;
    }

    /* Pantallas secundarias */

    .view {
      display: none;
    }

    .view.active {
      display: block;
    }

    .back-btn {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 8px 14px;
      border-radius: 999px;
      border: none;
      margin-bottom: 16px;
      font-size: 0.9rem;
      font-weight: 600;
      cursor: pointer;
      background: linear-gradient(135deg,#22c55e,#4ade80);
      color: #052e16;
      box-shadow: 0 10px 25px rgba(34,197,94,0.35);
    }

    .back-btn span.icon {
      font-size: 1rem;
    }

    .summary-title {
      font-size: 1.4rem;
      margin-bottom: 10px;
    }

    .summary-grid {
      margin: 10px 0 14px;
      font-size: 0.9rem;
    }

    .summary-grid-row {
      display: flex;
      justify-content: space-between;
      margin-bottom: 4px;
    }

    .summary-grid-row span.value {
      font-weight: 600;
    }

    .progress-group {
      margin-top: 10px;
    }

    .progress-label-row {
      display: flex;
      justify-content: space-between;
      font-size: 0.8rem;
      margin-bottom: 2px;
    }

    .bar-outer {
      width: 100%;
      height: 8px;
      border-radius: 999px;
      background: #020617;
      overflow: hidden;
      border: 1px solid #1f2933;
      margin-bottom: 6px;
    }

    .bar-inner {
      height: 100%;
      border-radius: 999px;
      background: linear-gradient(90deg,#22c55e,#a855f7);
      width: 0%;
      transition: width 0.25s ease-out;
    }

    .summary-note {
      font-size: 0.8rem;
      color: var(--muted);
      margin-top: 8px;
    }

    .comidas-list {
      margin-top: 14px;
      border-top: 1px solid rgba(148,163,184,0.25);
      padding-top: 10px;
    }

    .comida-item {
      padding: 8px 10px;
      border-radius: 14px;
      background: linear-gradient(135deg,#020617,#020617,#020617);
      border: 1px solid rgba(148,163,184,0.2);
      margin-bottom: 8px;
    }

    .comida-header {
      display: flex;
      justify-content: space-between;
      font-size: 0.86rem;
      margin-bottom: 4px;
    }

    .comida-macros {
      font-size: 0.8rem;
      color: var(--muted);
      margin-top: 2px;
    }

    .btn-small-danger {
      margin-top: 6px;
      font-size: 0.76rem;
      border-radius: 999px;
      border: none;
      padding: 4px 10px;
      background: linear-gradient(135deg,#b91c1c,#ef4444);
      color: #fee2e2;
      cursor: pointer;
    }

    .base-list {
      margin-top: 6px;
      max-height: 420px;
      overflow-y: auto;
    }

    .base-item {
      padding: 7px 10px;
      border-radius: 14px;
      border: 1px solid rgba(148,163,184,0.24);
      background: linear-gradient(135deg,#020617,#020617,#020617);
      font-size: 0.84rem;
      margin-bottom: 6px;
    }

    .base-row-top {
      display: flex;
      justify-content: space-between;
      gap: 8px;
      margin-bottom: 2px;
    }

    .badge {
      font-size: 0.7rem;
      padding: 2px 8px;
      border-radius: 999px;
      background: rgba(34,197,94,0.12);
      color: #bbf7d0;
    }

    .base-macros {
      font-size: 0.78rem;
      color: var(--muted);
    }

    .btn-small-outline-danger {
      border-radius: 999px;
      border: 1px solid rgba(248,113,113,0.85);
      background: transparent;
      color: #fecaca;
      font-size: 0.72rem;
      padding: 3px 8px;
      cursor: pointer;
      margin-left: 8px;
    }

    @media (max-width: 480px) {
      .card {
        padding: 16px 14px 20px;
        border-radius: 18px;
      }
      h1 {
        font-size: 1.6rem;
      }
      .subtitle {
        font-size: 0.8rem;
      }
      .btn {
        font-size: 0.95rem;
      }
    }
  </style>
</head>
<body>
  <div class="app-shell">
    <div class="card">

      <!-- PANTALLA PRINCIPAL -->
      <div id="pantallaPrincipal" class="view active">
        <h1>CaloriFlow</h1>
        <p class="subtitle">Registro diario con memoria propia.</p>

        <div class="field-group">
          <label for="tipoComida">Tipo de comida</label>
          <select id="tipoComida">
            <option>Desayuno</option>
            <option>Almuerzo</option>
            <option>Merienda</option>
            <option>Cena</option>
            <option>Colaci√≥n</option>
          </select>
        </div>

        <div class="field-group">
          <label for="descripcion">¬øQu√© comiste?</label>
          <textarea id="descripcion" placeholder="Ej: 1 taza de caf√© con leche"></textarea>
        </div>

        <div class="field-group">
          <div class="pill-label">Atajo opcional</div>
          <div class="row">
            <div>
              <label for="cantidad">Cant.</label>
              <input id="cantidad" type="number" min="0" step="0.5" placeholder="1" />
            </div>
            <div>
              <label for="unidad">Unidad</label>
              <select id="unidad">
                <option value="taza">taza</option>
                <option value="vaso">vaso</option>
                <option value="plato">plato</option>
                <option value="porci√≥n">porci√≥n</option>
                <option value="unidad">unidad</option>
              </select>
            </div>
            <div>
              <label for="alimento">Alimento</label>
              <input id="alimento" type="text" placeholder="caf√© con leche" />
            </div>
          </div>
          <p class="hint">
            Si complet√°s cantidad, unidad y alimento, se arma solo la descripci√≥n arriba.
          </p>
        </div>

        <button id="btnPrompt" class="btn btn-primary">
          <span class="icon">üß†</span>
          <span>Generar prompt para ChatGPT</span>
        </button>
        <p class="hint">
          Se copia el prompt al portapapeles y se abre ChatGPT. Peg√°s el prompt, copi√°s el JSON de respuesta y lo tra√©s ac√°.
        </p>

        <div class="field-group" style="margin-top: 10px;">
          <label for="jsonChatGPT">Pega aqu√≠ el resultado de ChatGPT (JSON)</label>
          <textarea id="jsonChatGPT" placeholder='{"calorias":120,"azucares_g":10,"grasas_g":4,"proteinas_g":6}'></textarea>
        </div>

        <button id="btnAgregar" class="btn btn-good">
          <span class="icon">‚úÖ</span>
          <span>Agregar comida</span>
        </button>

        <button id="btnResumen" class="btn btn-warn">
          <span class="icon">üìä</span>
          <span>Ver resumen de hoy</span>
        </button>

        <button id="btnBase" class="btn btn-secondary">
          <span class="icon">üìö</span>
          <span>Ver base aprendida</span>
        </button>

        <div id="mensajeEstado" class="status-msg"></div>

        <p class="hint" style="margin-top: 10px;">
          Todo se guarda solo en este dispositivo usando almacenamiento local.
        </p>
      </div>

      <!-- PANTALLA RESUMEN -->
      <div id="pantallaResumen" class="view">
        <button class="back-btn" id="btnVolverPrincipal1">
          <span class="icon">‚¨ÖÔ∏è</span>
          <span>Volver al registro</span>
        </button>

        <h2 class="summary-title">Resumen de hoy</h2>

        <div id="resumenContenido">
          <!-- Se llena por JS -->
        </div>
      </div>

      <!-- PANTALLA BASE APRENDIDA -->
      <div id="pantallaBase" class="view">
        <button class="back-btn" id="btnVolverPrincipal2">
          <span class="icon">‚¨ÖÔ∏è</span>
          <span>Volver al registro</span>
        </button>

        <h2 class="summary-title">Base aprendida</h2>
        <p class="hint">
          La app recuerda las comidas que ya registraste con su JSON. Si repet√≠s exactamente la misma descripci√≥n, puede usar estos valores sin pedir de nuevo a ChatGPT.
        </p>

        <div id="listaBase" class="base-list">
          <!-- Llenado por JS -->
        </div>
      </div>

    </div>
  </div>

  <script>
    // ---------- Utilidades de fecha ----------
    function hoyClave() {
      const d = new Date();
      return d.toISOString().slice(0, 10); // YYYY-MM-DD
    }

    function normalizarDescripcion(texto) {
      return (texto || "")
        .toLowerCase()
        .normalize("NFD").replace(/[\u0300-\u036f]/g, "")
        .replace(/\s+/g, " ")
        .trim();
    }

    // ---------- Estado en localStorage ----------
    const LS_COMIDAS = "caloriflow_comidas_diarias";
    const LS_BASE = "caloriflow_base_aprendida";

    function cargarComidas() {
      try {
        return JSON.parse(localStorage.getItem(LS_COMIDAS)) || {};
      } catch {
        return {};
      }
    }

    function guardarComidas(data) {
      localStorage.setItem(LS_COMIDAS, JSON.stringify(data));
    }

    function cargarBase() {
      try {
        return JSON.parse(localStorage.getItem(LS_BASE)) || {};
      } catch {
        return {};
      }
    }

    function guardarBase(data) {
      localStorage.setItem(LS_BASE, JSON.stringify(data));
    }

    // ---------- Atajo para armar descripci√≥n ----------
    const cantidadInput = document.getElementById("cantidad");
    const unidadSelect = document.getElementById("unidad");
    const alimentoInput = document.getElementById("alimento");
    const descripcionTextarea = document.getElementById("descripcion");

    function actualizarDescripcionDesdeAtajo() {
      const cant = cantidadInput.value.trim();
      const unidad = unidadSelect.value;
      const alimento = alimentoInput.value.trim();

      if (!cant || !alimento) return;

      let texto;
      if (unidad === "unidad") {
        texto = `${cant} ${unidad} de ${alimento}`;
      } else {
        texto = `${cant} ${unidad} de ${alimento}`;
      }
      descripcionTextarea.value = texto;
    }

    cantidadInput.addEventListener("input", actualizarDescripcionDesdeAtajo);
    unidadSelect.addEventListener("change", actualizarDescripcionDesdeAtajo);
    alimentoInput.addEventListener("input", actualizarDescripcionDesdeAtajo);

    // ---------- Generar prompt ----------
    const btnPrompt = document.getElementById("btnPrompt");

    btnPrompt.addEventListener("click", async () => {
      const descripcion = descripcionTextarea.value.trim();
      if (!descripcion) {
        alert("Escrib√≠ primero qu√© comiste para poder armar el prompt.");
        return;
      }

      const prompt = `
Te voy a describir una comida y quiero que estimes sus valores nutricionales aproximados.

Comida: "${descripcion}"

Devu√©lveme SOLO un JSON v√°lido, en una sola l√≠nea, sin ning√∫n texto extra, sin comentarios y sin explicaci√≥n.
Usa exactamente estas claves (en min√∫scula) y n√∫meros como valores:

{
  "calorias": 0,
  "azucares_g": 0,
  "grasas_g": 0,
  "proteinas_g": 0
}

Completa los valores con tus mejores estimaciones. No agregues m√°s campos.
      `.trim();

      try {
        await navigator.clipboard.writeText(prompt);
        alert("Prompt copiado al portapapeles. Ahora se abrir√° ChatGPT.");
      } catch (e) {
        alert("No pude copiar al portapapeles autom√°ticamente. Si quer√©s, copi√° el texto manualmente.");
        console.log(e);
      }

      // Intentar abrir ChatGPT en nueva pesta√±a
      window.open("https://chat.openai.com", "_blank");
    });

    // ---------- Agregar comida ----------
    const btnAgregar = document.getElementById("btnAgregar");
    const tipoComidaSelect = document.getElementById("tipoComida");
    const jsonTextarea = document.getElementById("jsonChatGPT");
    const mensajeEstado = document.getElementById("mensajeEstado");

    btnAgregar.addEventListener("click", () => {
      mensajeEstado.textContent = "";
      const tipo = tipoComidaSelect.value;
      const desc = descripcionTextarea.value.trim();

      if (!desc) {
        alert("Necesito que escribas qu√© comiste.");
        return;
      }

      const clave = normalizarDescripcion(desc);

      let base = cargarBase();
      let comidas = cargarComidas();
      const dia = hoyClave();

      let macros = null;
      const jsonText = jsonTextarea.value.trim();

      if (jsonText) {
        try {
          const parsed = JSON.parse(jsonText);
          if (
            typeof parsed.calorias !== "number" ||
            typeof parsed.azucares_g !== "number" ||
            typeof parsed.grasas_g !== "number" ||
            typeof parsed.proteinas_g !== "number"
          ) {
            alert("El JSON debe tener solo n√∫meros en calorias, azucares_g, grasas_g y proteinas_g.");
            return;
          }
          macros = {
            calorias: parsed.calorias,
            azucares_g: parsed.azucares_g,
            grasas_g: parsed.grasas_g,
            proteinas_g: parsed.proteinas_g
          };
          // Actualizar base aprendida
          base[clave] = {
            descripcion: desc,
            ...macros
          };
          guardarBase(base);
        } catch (e) {
          alert("El JSON que pegaste no es v√°lido. Revisalo en ChatGPT.");
          return;
        }
      } else {
        // Intentar usar base aprendida
        if (base[clave]) {
          macros = {
            calorias: base[clave].calorias,
            azucares_g: base[clave].azucares_g,
            grasas_g: base[clave].grasas_g,
            proteinas_g: base[clave].proteinas_g
          };
        } else {
          alert("Para esta comida la app todav√≠a no tiene datos guardados. Peg√° al menos una vez el JSON de ChatGPT.");
          return;
        }
      }

      if (!comidas[dia]) comidas[dia] = [];

      comidas[dia].push({
        tipo,
        descripcion: desc,
        ...macros,
        timestamp: Date.now()
      });

      guardarComidas(comidas);

      // Limpiar campos
      descripcionTextarea.value = "";
      jsonTextarea.value = "";
      cantidadInput.value = "";
      alimentoInput.value = "";
      unidadSelect.value = "porci√≥n";

      mensajeEstado.textContent = "Comida guardada.";
      setTimeout(() => {
        mensajeEstado.textContent = "";
      }, 2500);
    });

    // ---------- Cambio de vistas ----------
    const pantallaPrincipal = document.getElementById("pantallaPrincipal");
    const pantallaResumen = document.getElementById("pantallaResumen");
    const pantallaBase = document.getElementById("pantallaBase");
    const btnResumen = document.getElementById("btnResumen");
    const btnBase = document.getElementById("btnBase");
    const btnVolverPrincipal1 = document.getElementById("btnVolverPrincipal1");
    const btnVolverPrincipal2 = document.getElementById("btnVolverPrincipal2");

    function mostrarVista(id) {
      pantallaPrincipal.classList.remove("active");
      pantallaResumen.classList.remove("active");
      pantallaBase.classList.remove("active");

      if (id === "principal") pantallaPrincipal.classList.add("active");
      if (id === "resumen") pantallaResumen.classList.add("active");
      if (id === "base") pantallaBase.classList.add("active");
    }

    btnResumen.addEventListener("click", () => {
      construirResumenHoy();
      mostrarVista("resumen");
    });

    btnBase.addEventListener("click", () => {
      construirBaseAprendida();
      mostrarVista("base");
    });

    btnVolverPrincipal1.addEventListener("click", () => mostrarVista("principal"));
    btnVolverPrincipal2.addEventListener("click", () => mostrarVista("principal"));

    // ---------- Resumen de hoy ----------
    const resumenContenido = document.getElementById("resumenContenido");

    function construirResumenHoy() {
      const comidas = cargarComidas();
      const dia = hoyClave();
      const lista = comidas[dia] || [];

      if (!lista.length) {
        resumenContenido.innerHTML = `
          <p class="hint-strong">Todav√≠a no registraste comidas hoy.</p>
        `;
        return;
      }

      let totalCal = 0, totalAz = 0, totalGr = 0, totalPr = 0;

      for (const c of lista) {
        totalCal += c.calorias || 0;
        totalAz += c.azucares_g || 0;
        totalGr += c.grasas_g || 0;
        totalPr += c.proteinas_g || 0;
      }

      // Metas sugeridas
      const metaCal = 2000;
      const metaAz = 50;
      const metaGr = 60;
      const metaPr = 70;

      function pct(total, meta) {
        if (!meta) return 0;
        return Math.min(100, Math.round((total / meta) * 100));
      }

      const pctCal = pct(totalCal, metaCal);
      const pctAz = pct(totalAz, metaAz);
      const pctGr = pct(totalGr, metaGr);
      const pctPr = pct(totalPr, metaPr);

      let nota;
      if (pctCal < 40) {
        nota = "Vas bastante por debajo de tu meta de calor√≠as. Asegurate de no saltarte comidas importantes.";
      } else if (pctCal > 110) {
        nota = "Superaste la meta de calor√≠as sugerida para el d√≠a. Pod√©s ajustar en las siguientes comidas si quer√©s equilibrar.";
      } else {
        nota = "Est√°s dentro de un rango razonable de tu meta de calor√≠as para el d√≠a.";
      }

      const itemsHTML = lista
        .map((c, idx) => {
          const hora = new Date(c.timestamp || Date.now()).toLocaleTimeString([], {
            hour: "2-digit",
            minute: "2-digit"
          });
          return `
            <div class="comida-item">
              <div class="comida-header">
                <span><strong>${c.tipo}</strong> ¬∑ ${hora}</span>
                <button class="btn-small-danger" data-idx="${idx}">Eliminar</button>
              </div>
              <div>${c.descripcion}</div>
              <div class="comida-macros">
                ${c.calorias.toFixed(1)} kcal ¬∑
                ${c.proteinas_g.toFixed(1)} g prot ¬∑
                ${c.grasas_g.toFixed(1)} g grasa ¬∑
                ${c.azucares_g.toFixed(1)} g az√∫car
              </div>
            </div>
          `;
        })
        .join("");

      resumenContenido.innerHTML = `
        <div class="summary-grid">
          <div class="summary-grid-row">
            <span>Calor√≠as totales:</span>
            <span class="value">${totalCal.toFixed(1)}</span>
          </div>
          <div class="summary-grid-row">
            <span>Az√∫cares totales (g):</span>
            <span class="value">${totalAz.toFixed(1)}</span>
          </div>
          <div class="summary-grid-row">
            <span>Grasas totales (g):</span>
            <span class="value">${totalGr.toFixed(1)}</span>
          </div>
          <div class="summary-grid-row">
            <span>Prote√≠nas totales (g):</span>
            <span class="value">${totalPr.toFixed(1)}</span>
          </div>
        </div>

        <div class="progress-group">
          <div class="pill-label" style="margin-bottom:6px;">Progreso vs metas</div>

          <div class="progress-label-row">
            <span>Calor√≠as</span>
            <span>${totalCal.toFixed(0)} / ${metaCal}</span>
          </div>
          <div class="bar-outer"><div class="bar-inner" style="width:${pctCal}%;"></div></div>

          <div class="progress-label-row">
            <span>Az√∫cares (g)</span>
            <span>${totalAz.toFixed(1)} / ${metaAz}</span>
          </div>
          <div class="bar-outer"><div class="bar-inner" style="width:${pctAz}%;"></div></div>

          <div class="progress-label-row">
            <span>Grasas (g)</span>
            <span>${totalGr.toFixed(1)} / ${metaGr}</span>
          </div>
          <div class="bar-outer"><div class="bar-inner" style="width:${pctGr}%;"></div></div>

          <div class="progress-label-row">
            <span>Prote√≠nas (g)</span>
            <span>${totalPr.toFixed(1)} / ${metaPr}</span>
          </div>
          <div class="bar-outer"><div class="bar-inner" style="width:${pctPr}%;"></div></div>
        </div>

        <p class="summary-note">${nota}</p>

        <div class="comidas-list">
          <div class="pill-label" style="margin-bottom:6px;">Comidas registradas</div>
          ${itemsHTML}
        </div>
      `;

      // Botones eliminar
      resumenContenido
        .querySelectorAll(".btn-small-danger")
        .forEach((btn) => {
          btn.addEventListener("click", () => {
            const idx = parseInt(btn.getAttribute("data-idx"), 10);
            const data = cargarComidas();
            const arr = data[dia] || [];
            arr.splice(idx, 1);
            data[dia] = arr;
            guardarComidas(data);
            construirResumenHoy();
          });
        });
    }

    // ---------- Base aprendida ----------
    const listaBaseDiv = document.getElementById("listaBase");

    function construirBaseAprendida() {
      const base = cargarBase();
      const claves = Object.keys(base);

      if (!claves.length) {
        listaBaseDiv.innerHTML = `<p class="hint-strong">Todav√≠a no hay comidas aprendidas.</p>`;
        return;
      }

      const html = claves
        .map((k) => {
          const item = base[k];
          return `
            <div class="base-item">
              <div class="base-row-top">
                <div>${item.descripcion}</div>
                <div>
                  <span class="badge">Guardado</span>
                  <button class="btn-small-outline-danger" data-key="${k}">
                    Eliminar
                  </button>
                </div>
              </div>
              <div class="base-macros">
                ${item.calorias.toFixed(1)} kcal ¬∑
                ${item.proteinas_g.toFixed(1)} g prot ¬∑
                ${item.grasas_g.toFixed(1)} g grasa ¬∑
                ${item.azucares_g.toFixed(1)} g az√∫car
              </div>
            </div>
          `;
        })
        .join("");

      listaBaseDiv.innerHTML = html;

      listaBaseDiv.querySelectorAll(".btn-small-outline-danger")
        .forEach((btn) => {
          btn.addEventListener("click", () => {
            const key = btn.getAttribute("data-key");
            const base = cargarBase();
            delete base[key];
            guardarBase(base);
            construirBaseAprendida();
          });
        });
    }
  </script>
</body>
</html>