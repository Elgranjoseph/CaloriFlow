<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>CaloriFlow ¬∑ ChatGPT helper</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    :root {
      --bg-main: #050712;
      --bg-card: #0d1020;
      --bg-soft: #15182b;
      --accent: #e14bff;
      --accent-2: #7b5cff;
      --danger: #ff4b6a;
      --text-main: #f7f7ff;
      --text-muted: #b3b7d0;
      --border-soft: #26283d;
    }

    * {
      box-sizing: border-box;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "SF Pro Text",
        "Segoe UI", sans-serif;
    }

    body {
      margin: 0;
      min-height: 100vh;
      background: radial-gradient(circle at top left, #261d4a 0, #050712 45%);
      color: var(--text-main);
      display: flex;
      justify-content: center;
    }

    .app {
      width: 100%;
      max-width: 480px;
      padding: 20px 16px 32px;
    }

    h1 {
      margin: 0;
      font-size: 26px;
    }

    .subtitle {
      font-size: 13px;
      color: var(--text-muted);
      margin-top: 4px;
    }

    .card {
      background: radial-gradient(circle at top left, #1c1f3c, #050816 65%);
      border-radius: 20px;
      padding: 16px 14px;
      margin-top: 16px;
      border: 1px solid rgba(148, 163, 255, 0.25);
      box-shadow: 0 16px 40px rgba(0, 0, 0, 0.85);
    }

    .card h2 {
      margin: 0 0 4px;
      font-size: 18px;
    }

    .card p {
      margin: 0;
      font-size: 13px;
      color: var(--text-muted);
    }

    label {
      display: block;
      font-size: 13px;
      margin-top: 10px;
      margin-bottom: 4px;
      color: var(--text-muted);
    }

    input[type="text"],
    input[type="number"],
    select,
    textarea {
      width: 100%;
      border-radius: 12px;
      border: 1px solid var(--border-soft);
      background: rgba(6, 9, 24, 0.95);
      color: var(--text-main);
      font-size: 14px;
      padding: 9px 11px;
      outline: none;
    }

    textarea {
      min-height: 70px;
      resize: vertical;
    }

    input:focus,
    select:focus,
    textarea:focus {
      border-color: var(--accent-2);
      box-shadow: 0 0 0 1px rgba(129, 140, 248, 0.6);
    }

    .small-helper {
      font-size: 12px;
      color: var(--text-muted);
      margin-top: 3px;
    }

    .btn {
      width: 100%;
      border-radius: 999px;
      border: none;
      padding: 12px 14px;
      margin-top: 14px;
      font-size: 15px;
      font-weight: 600;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
    }

    .btn-primary {
      background: linear-gradient(135deg, var(--accent-2), var(--accent));
      color: #12071f;
      box-shadow: 0 16px 32px rgba(0, 0, 0, 0.9);
    }

    .btn-secondary {
      background: rgba(15, 23, 42, 0.9);
      color: var(--text-main);
      border: 1px solid var(--border-soft);
    }

    .values-grid {
      display: grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap: 10px;
      margin-top: 10px;
    }

    .badge {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      font-size: 11px;
      padding: 4px 9px;
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 255, 0.55);
      background: rgba(8, 12, 32, 0.95);
      margin-top: 8px;
    }

    .status {
      margin-top: 8px;
      font-size: 13px;
      min-height: 18px;
      color: var(--text-muted);
    }
  </style>
</head>
<body>
<div class="app">
  <h1>CaloriFlow ¬∑ ChatGPT</h1>
  <div class="subtitle">
    Escrib√≠ lo que comiste, abr√≠ ChatGPT con el prompt listo y luego import√° los valores.
  </div>

  <!-- Secci√≥n de comida -->
  <div class="card">
    <h2>Nueva comida</h2>
    <p>Describe la comida. Tu sesi√≥n de ChatGPT har√° el c√°lculo.</p>

    <label for="mealType">Tipo de comida</label>
    <select id="mealType">
      <option value="Desayuno">Desayuno</option>
      <option value="Almuerzo">Almuerzo</option>
      <option value="Merienda">Merienda</option>
      <option value="Cena">Cena</option>
      <option value="Snack">Snack</option>
    </select>

    <label for="mealDescription">¬øQu√© comiste?</label>
    <textarea
      id="mealDescription"
      placeholder="Ej: 2 tostadas con mermelada y 1 taza de caf√© con leche"
    ></textarea>
    <div class="small-helper">
      Cuanto m√°s claro seas (porciones, tama√±o, ingredientes), mejor.
    </div>

    <button class="btn btn-primary" id="btnOpenChatGPT">
      üí¨ Abrir en ChatGPT con prompt listo
    </button>

    <div class="status" id="statusInfo">
      Ten√©s que estar logueado en <strong>chat.openai.com</strong> en el navegador.
    </div>
  </div>

  <!-- Importar JSON devuelto por ChatGPT -->
  <div class="card">
    <h2>Importar respuesta de ChatGPT</h2>
    <p>
      Pedile a ChatGPT que te devuelva <strong>S√ìLO un JSON</strong> con estos
      campos:
    </p>
    <div class="badge">
      {"calorias": 0, "azucares_g": 0, "grasas_g": 0, "proteinas_g": 0}
    </div>

    <label for="jsonChatGPT">Peg√° aqu√≠ el JSON que te devolvi√≥ ChatGPT</label>
    <textarea
      id="jsonChatGPT"
      placeholder='Ej: {"calorias": 320, "azucares_g": 18, "grasas_g": 10, "proteinas_g": 12}'
    ></textarea>

    <button class="btn btn-secondary" id="btnImportJson">
      ‚¨á Importar valores en los campos
    </button>

    <div class="values-grid">
      <div>
        <label for="caloriesInput">Calor√≠as (kcal)</label>
        <input type="number" id="caloriesInput" placeholder="Ej: 320" />
      </div>
      <div>
        <label for="sugarInput">Az√∫cares (g)</label>
        <input type="number" id="sugarInput" placeholder="Ej: 18" />
      </div>
      <div>
        <label for="fatInput">Grasas (g)</label>
        <input type="number" id="fatInput" placeholder="Ej: 10" />
      </div>
      <div>
        <label for="proteinInput">Prote√≠nas (g)</label>
        <input type="number" id="proteinInput" placeholder="Ej: 12" />
      </div>
    </div>
  </div>
</div>

<script>
  function buildPrompt() {
    const tipo = document.getElementById("mealType").value;
    const desc = document.getElementById("mealDescription").value.trim();

    if (!desc) {
      alert("Escrib√≠ primero qu√© comiste.");
      return null;
    }

    const prompt = `
Eres un nutricionista experto.

Analiza la siguiente comida y devuelve solo un JSON:

Tipo de comida: ${tipo}
Descripci√≥n detallada de la comida: "${desc}"

Quiero que estimes de forma realista:
- calor√≠as totales (kcal)
- gramos de az√∫cares
- gramos de grasas
- gramos de prote√≠nas

IMPORTANTE:
Responde SOLO un JSON v√°lido, sin texto extra, sin comentarios, sin explicaci√≥n.
Usa exactamente este formato de claves:
{
  "calorias": 0,
  "azucares_g": 0,
  "grasas_g": 0,
  "proteinas_g": 0
}
Completa los valores con n√∫meros (pueden ser decimales).
`;
    return prompt.trim();
  }

  function openChatGPT() {
    const prompt = buildPrompt();
    if (!prompt) return;

    // Armamos URL para abrir ChatGPT con el prompt prellenado.
    // El usuario solo revisa y aprieta Enviar.
    const url = "https://chat.openai.com/?q=" + encodeURIComponent(prompt);
    window.open(url, "_blank");
  }

  function importFromJson() {
    const raw = document.getElementById("jsonChatGPT").value.trim();
    if (!raw) {
      alert("Peg√° el JSON que te devolvi√≥ ChatGPT.");
      return;
    }

    try {
      const data = JSON.parse(raw);

      document.getElementById("caloriesInput").value =
        data.calorias ?? "";
      document.getElementById("sugarInput").value =
        data.azucares_g ?? "";
      document.getElementById("fatInput").value =
        data.grasas_g ?? "";
      document.getElementById("proteinInput").value =
        data.proteinas_g ?? "";

      alert("Valores importados.");
    } catch (e) {
      alert("El texto pegado no es un JSON v√°lido. Revis√° el formato.");
    }
  }

  document
    .getElementById("btnOpenChatGPT")
    .addEventListener("click", openChatGPT);
  document
    .getElementById("btnImportJson")
    .addEventListener("click", importFromJson);
</script>
</body>
</html>