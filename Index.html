<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>CaloriFlow</title>
<style>
  body {
    font-family: Arial, sans-serif;
    background: #0d1117;
    color: white;
    margin: 0;
    padding: 20px;
  }
  h1 {
    text-align: center;
  }
  .container {
    background: #161b22;
    padding: 20px;
    border-radius: 10px;
    max-width: 600px;
    margin: auto;
  }
  select, textarea, button, input {
    width: 100%;
    margin-top: 10px;
    padding: 12px;
    border-radius: 8px;
    border: none;
    font-size: 16px;
  }
  button {
    cursor: pointer;
    font-weight: bold;
  }
  .btn-prompt {
    background: #4169e1;
    color: white;
  }
  .btn-add {
    background: #2ecc71;
    color: black;
    font-size: 18px;
  }
  .btn-summary {
    background: #f1c40f;
    color: black;
    font-weight: bold;
  }
  .small-note {
    font-size: 13px;
    color: #9ca3af;
    margin-top: 5px;
  }
</style>
</head>

<body>
<h1>CaloriFlow</h1>

<div class="container">

  <label>Tipo de comida</label>
  <select id="tipoComida">
    <option>Desayuno</option>
    <option>Almuerzo</option>
    <option>Cena</option>
    <option>Merienda</option>
    <option>Snack</option>
  </select>

  <label>¬øQu√© comiste?</label>
  <textarea id="items" placeholder="Ej: 1 taza de caf√© con leche"></textarea>

  <button class="btn-prompt" id="btnPrompt">
    üß† Generar prompt para ChatGPT
  </button>

  <label>Pega aqu√≠ el resultado de ChatGPT (JSON)</label>
  <textarea id="jsonInput" placeholder='{"calorias":120,"azucares_g":10,"grasas_g":4,"proteinas_g":6}'></textarea>

  <button class="btn-add" id="btnAdd">
    ‚úîÔ∏è Agregar comida
  </button>

  <p id="statusMsg" class="small-note"></p>

  <button class="btn-summary" onclick="location.href='resumen.html'">
    üìä Ver resumen de hoy
  </button>

</div>

<script>
  // CARGAR BASE DE DATOS DE COMIDAS APRENDIDAS
  let base = JSON.parse(localStorage.getItem("baseComidas") || "{}");

  const tipoComidaSelect = document.getElementById("tipoComida");
  const itemsInput = document.getElementById("items");
  const jsonInput = document.getElementById("jsonInput");
  const btnPrompt = document.getElementById("btnPrompt");
  const btnAdd = document.getElementById("btnAdd");
  const statusMsg = document.getElementById("statusMsg");

  // ----------------------------
  // GENERAR PROMPT PARA CHATGPT
  // ----------------------------
  btnPrompt.addEventListener("click", () => {
    const tipo = tipoComidaSelect.value;
    const items = itemsInput.value.trim();

    const prompt = `
Eres un nutricionista.

Analiza la siguiente comida COMPLETA y devuelve los valores totales:

Tipo de comida: ${tipo}

√çtems de la comida:
${items || "- (especifica la comida aqu√≠)"}

Quiero que estimes:
- calor√≠as totales (kcal)
- gramos de az√∫cares
- gramos de grasas
- gramos de prote√≠nas

IMPORTANTE:
- Responde SOLO un JSON v√°lido.
- SIN explicaciones, SIN comentarios.
- NO uses bloques de c√≥digo.

Formato exacto:
{"calorias":0,"azucares_g":0,"grasas_g":0,"proteinas_g":0}

Rellena los valores con n√∫meros (pueden ser decimales).`;

    navigator.clipboard.writeText(prompt).catch(()=>{});

    // ‚ö†Ô∏è AC√Å EL CAMBIO: usa chat.openai.com (funciona en tu celular)
    window.open("https://chat.openai.com", "_blank");

    alert("El prompt fue copiado. Pegalo directamente en tu ChatGPT.");
  });

  // -------------------------------------
  // AGREGAR COMIDA Y GUARDAR EN MEMORIA
  // -------------------------------------
  btnAdd.addEventListener("click", () => {
    const desc = itemsInput.value.trim();
    if (!desc) {
      statusMsg.textContent = "Escrib√≠ qu√© comiste antes de agregar.";
      return;
    }

    // Si NO pegaste JSON, intento recuperar lo APRENDIDO
    let obj = null;

    if (jsonInput.value.trim() !== "") {
      try {
        obj = JSON.parse(jsonInput.value.trim());
        base[desc] = obj;   // guardar aprendizaje
        localStorage.setItem("baseComidas", JSON.stringify(base));
      } catch {
        statusMsg.textContent = "El JSON no es v√°lido.";
        return;
      }
    } else {
      // no hay JSON ‚Üí usar valores aprendidos
      if (!base[desc]) {
        statusMsg.textContent =
          "Comida nueva: primero gener√° el JSON con ChatGPT.";
        return;
      }
      obj = base[desc];
    }

    let comidas = JSON.parse(localStorage.getItem("comidasHoy") || "[]");

    comidas.push({
      tipo: tipoComidaSelect.value,
      descripcion: desc,
      ...obj,
      hora: new Date().toLocaleTimeString()
    });

    localStorage.setItem("comidasHoy", JSON.stringify(comidas));

    statusMsg.textContent = "Comida guardada ‚úîÔ∏è";

    // limpiar inputs
    itemsInput.value = "";
    jsonInput.value = "";
  });
</script>

</body>
</html>